metadata:
  name: export-data
  labels:
    nuclio.io/project-name: repoadopt
spec:
  description: "more shit."
  handler: "main:handler"
  runtime: "python:3.6"
  env:
    - name: mongo_url
      value: "mongodb://localhost/"
    - name: mongo_port
      value: "27017"
    - name: db_name
      value: RepoAdopt
    - name: from_email
      value: repoadopt@gmail.com
    - name: password_email
      value: Some_pass
  resources: {}
  minReplicas: 1
  maxReplicas: 1
  triggers:
    default-http:
      class: ""
      kind: http
      name: default-http
      maxWorkers: 1
      attributes:
        cors:
          allowCredentials: false
          allowHeaders:
            - 'authorization,content-type'
          allowMethods:
            - POST
          enabled: true
          preflightMaxAgeSeconds: 3600
        port: 9702
  version: 1
  build:
    functionSourceCode: ZnJvbSBvcyBpbXBvcnQgZ2V0ZW52Cgpmcm9tIG1vbmdvZW5naW5lIGltcG9ydCBEb2N1bWVudCwgY29ubmVjdApmcm9tIG1vbmdvZW5naW5lLmZpZWxkcyBpbXBvcnQgU3RyaW5nRmllbGQsIFJlZmVyZW5jZUZpZWxkLCBEYXRlVGltZUZpZWxkLCBPYmplY3RJZEZpZWxkCgoKY2xhc3MgQWRvcHRhYmxlKERvY3VtZW50KToKICAgIG1ldGEgPSB7CiAgICAgICAgImNvbGxlY3Rpb24iOiAiYWRvcHRhYmxlcyIsCiAgICB9CiAgICByZXBvc2l0b3J5ID0gU3RyaW5nRmllbGQocmVxdWlyZWQ9VHJ1ZSkKICAgIGRlc2NyaXB0aW9uID0gU3RyaW5nRmllbGQocmVxdWlyZWQ9RmFsc2UpCiAgICBvd25lciA9IFN0cmluZ0ZpZWxkKHJlcXVpcmVkPVRydWUpCiAgICBuZXdfb3duZXIgPSBTdHJpbmdGaWVsZChyZXF1aXJlZD1GYWxzZSkKCgpjbGFzcyBDaGF0TWVzc2FnZShEb2N1bWVudCk6CiAgICBtZXRhID0geyJjb2xsZWN0aW9uIjogImNoYXRtZXNzYWdlcyJ9CgogICAgdXNlciA9IFN0cmluZ0ZpZWxkKHJlcXVpcmVkPVRydWUpCiAgICBtZXNzYWdlID0gU3RyaW5nRmllbGQocmVxdWlyZWQ9VHJ1ZSkKICAgIHRpbWVzdGFtcCA9IERhdGVUaW1lRmllbGQocmVxdWlyZWQ9RmFsc2UpCiAgICBjaGF0X2lkID0gT2JqZWN0SWRGaWVsZChyZXF1aXJlZD1UcnVlKQoKCmNsYXNzIE1hdGNoKERvY3VtZW50KToKICAgIG1ldGEgPSB7CiAgICAgICAgImNvbGxlY3Rpb24iOiAibWF0Y2hlcyIsCiAgICB9CgogICAgdXNlciA9IFN0cmluZ0ZpZWxkKHJlcXVpcmVkPVRydWUpCiAgICBhZG9wdGFibGUgPSBSZWZlcmVuY2VGaWVsZChBZG9wdGFibGUpCgoKaW1wb3J0IHNtdHBsaWIsIHNzbAoKZnJvbSBlbWFpbCBpbXBvcnQgZW5jb2RlcnMKZnJvbSBlbWFpbC5taW1lLmJhc2UgaW1wb3J0IE1JTUVCYXNlCmZyb20gZW1haWwubWltZS5tdWx0aXBhcnQgaW1wb3J0IE1JTUVNdWx0aXBhcnQKZnJvbSBlbWFpbC5taW1lLnRleHQgaW1wb3J0IE1JTUVUZXh0CgppbXBvcnQgYmFzZTY0CmltcG9ydCBqc29uCgoKZGVmIGhhbmRsZXIoY29udGV4dCwgZXZlbnQpOgogICAgdG9rZW4gPSBqc29uLmxvYWRzKAogICAgICAgIGJhc2U2NC51cmxzYWZlX2I2NGRlY29kZSgKICAgICAgICAgICAgZXZlbnQuaGVhZGVycy5nZXQoIkF1dGhvcml6YXRpb24iKS5zcGxpdCgiLiIpWzFdICsgIj09IgogICAgICAgICkKICAgICkKCiAgICAjIENyZWF0ZSBtZXNzYWdlCiAgICBtZXNzYWdlID0gTUlNRU11bHRpcGFydCgpCiAgICBtZXNzYWdlWyJGcm9tIl0gPSBnZXRlbnYoImZyb21fZW1haWwiKQogICAgbWVzc2FnZVsiVG8iXSA9IHRva2VuLmdldCgiZW1haWwiKQogICAgbWVzc2FnZVsiU3ViamVjdCJdID0gIlJlcG9BZG9wdCB1c2VyIGRhdGEiCiAgICBtZXNzYWdlLmF0dGFjaCgKICAgICAgICBNSU1FVGV4dCgiVGhlIGF0dGFjaG1lbnQgb24gdGhpcyBlbWFpbCBjb250YWlucyB5b3VyIHVzZXIgZGF0YS4iLCAicGxhaW4iKQogICAgKQoKICAgICMgR2V0IGRhdGEKICAgIGNvbm5lY3QoCiAgICAgICAgZ2V0ZW52KCJkYl9uYW1lIiksCiAgICAgICAgaG9zdD1nZXRlbnYoIm1vbmdvX3VybCIpLAogICAgICAgIHBvcnQ9aW50KGdldGVudigibW9uZ29fcG9ydCIpKSwKICAgICAgICBhbGlhcz0iZGVmYXVsdCIsCiAgICApCgogICAgdXNlcm5hbWUgPSB0b2tlbi5nZXQoInVzZXJuYW1lIikKICAgIG1hdGNoZXMgPSBsaXN0KE1hdGNoLm9iamVjdHModXNlcj11c2VybmFtZSkuYWxsKCkpCiAgICBjaGF0X21lc3NhZ2VzID0gbGlzdChDaGF0TWVzc2FnZS5vYmplY3RzKHVzZXI9dXNlcm5hbWUpLmFsbCgpKQogICAgYWRvcHRhYmxlcyA9IGxpc3QoQWRvcHRhYmxlLm9iamVjdHMob3duZXI9dXNlcm5hbWUpLmFsbCgpKQoKICAgIGRlZiBjb252ZXJ0X3RvX3N0cmluZ19mb3JfcHJvcCh4LCBwcm9wKToKICAgICAgICBpZiBwcm9wIGluIHg6CiAgICAgICAgICAgIHhbcHJvcF0gPSBzdHIoeFtwcm9wXSkKCiAgICAgICAgcmV0dXJuIHgKCiAgICBkZWYgY29udmVydF90b19kaWN0KHgpOgogICAgICAgIHggPSB4LnRvX21vbmdvKCkKCiAgICAgICAgcHJvcHMgPSBbIl9pZCIsICJhZG9wdGFibGUiLCAiY2hhdF9pZCIsICJ0aW1lc3RhbXAiXQoKICAgICAgICBmb3IgcHJvcCBpbiBwcm9wczoKICAgICAgICAgICAgeCA9IGNvbnZlcnRfdG9fc3RyaW5nX2Zvcl9wcm9wKHgsIHByb3ApCgogICAgICAgIHJldHVybiBkaWN0KHgpCgogICAgbWF0Y2hlcyA9IGxpc3QobWFwKGNvbnZlcnRfdG9fZGljdCwgbWF0Y2hlcykpCiAgICBjaGF0X21lc3NhZ2VzID0gbGlzdChtYXAoY29udmVydF90b19kaWN0LCBjaGF0X21lc3NhZ2VzKSkKICAgIGFkb3B0YWJsZXMgPSBsaXN0KG1hcChjb252ZXJ0X3RvX2RpY3QsIGFkb3B0YWJsZXMpKQoKICAgIGpzb25fYm9keSA9IHsKICAgICAgICAibWF0Y2hlcyI6IG1hdGNoZXMsCiAgICAgICAgImNoYXRfbWVzc2FnZXMiOiBjaGF0X21lc3NhZ2VzLAogICAgICAgICJhZG9wdGFibGVzIjogYWRvcHRhYmxlcywKICAgIH0KCiAgICAjIEFkZCBhdHRhY2htZW50CiAgICBwYXJ0ID0gTUlNRUJhc2UoImFwcGxpY2F0aW9uIiwgImpzb24iKQogICAgcGFydC5zZXRfcGF5bG9hZChqc29uLmR1bXBzKGpzb25fYm9keSwgaW5kZW50PTQpKQoKICAgIGVuY29kZXJzLmVuY29kZV9iYXNlNjQocGFydCkKCiAgICBmaWxlbmFtZSA9ICJSZXBvYWRvcHQtdXNlcmRhdGEuanNvbiIKICAgIHBhcnQuYWRkX2hlYWRlcigKICAgICAgICAiQ29udGVudC1EaXNwb3NpdGlvbiIsCiAgICAgICAgZiJhdHRhY2htZW50OyBmaWxlbmFtZT0ge2ZpbGVuYW1lfSIsCiAgICApCgogICAgbWVzc2FnZS5hdHRhY2gocGFydCkKCiAgICAjIFNlbmQgbWVzc2FnZQogICAgdGV4dCA9IG1lc3NhZ2UuYXNfc3RyaW5nKCkKICAgIGNvbnRleHQgPSBzc2wuY3JlYXRlX2RlZmF1bHRfY29udGV4dCgpCgogICAgd2l0aCBzbXRwbGliLlNNVFBfU1NMKCJzbXRwLmdtYWlsLmNvbSIsIDQ2NSwgY29udGV4dD1jb250ZXh0KSBhcyBzZXJ2ZXI6CiAgICAgICAgc2VydmVyLmxvZ2luKGdldGVudigiZnJvbV9lbWFpbCIpLCBnZXRlbnYoInBhc3N3b3JkX2VtYWlsIikpCiAgICAgICAgc2VydmVyLnNlbmRtYWlsKGdldGVudigiZnJvbV9lbWFpbCIpLCB0b2tlbi5nZXQoImVtYWlsIiksIHRleHQpCg==
    commands:
      - 'pip install mongoengine'
    runtimeAttributes:
      repositories: []
    codeEntryType: sourceCode
    timestamp: 1622639150
  loggerSinks:
    - level: debug
  platform: {}
  readinessTimeoutSeconds: 60
  securityContext: {}
  eventTimeout: ""
